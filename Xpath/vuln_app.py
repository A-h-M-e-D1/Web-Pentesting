from flask import Flask, request, abort
from lxml import etree

app = Flask(__name__)


doc = etree.parse('/home/robot/Documents/Vulnerabilities/Xpath/employee.xml')

@app.route('/showdata', methods=['GET'])  
def show_data():
    employee_name = request.args.get('name')

    if employee_name is None:
        abort(400, description="Employee name missing")
    
    try:
        # Vulnerable XPath query with user input directly concatenated
        nodes = doc.xpath(
            "/employees/employee[name='" + employee_name + "']/text()"
        )
        response = '<ul>'
        for node in nodes:
            response += "<li>" + node + "</li>"
        response += "</ul>"
        return response
    except etree.XPathEvalError as e:
        return str(e)

if __name__ == "__main__":
    app.run(debug=True)


finally